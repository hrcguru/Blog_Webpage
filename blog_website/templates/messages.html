{% extends "base.html" %}

{% block title %}Contact Messages - Wisdom Blog{% endblock %}

{% block content %}
<div class="messages-container">
    <div class="messages-header">
        <h1><i class="fas fa-envelope"></i> Contact Messages</h1>
        <p>Manage messages from your website visitors</p>
    </div>

    {% if messages %}
    <div class="messages-stats">
        <div class="stat-card">
            <i class="fas fa-inbox"></i>
            <h3>Total Messages</h3>
            <p>{{ messages|length }}</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-envelope-open"></i>
            <h3>Unread</h3>
            <p>{{ messages|selectattr('is_read', 'equalto', False)|list|length }}</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-trash"></i>
            <h3>Actions</h3>
            <form action="{{ url_for('mark_all_messages_read') }}" method="POST" class="inline-form">
                <button type="submit" class="btn-link">Mark All Read</button>
            </form>
        </div>
    </div>

    <div class="messages-list">
        {% for message in messages %}
        <div class="message-card {% if not message.is_read %}unread{% endif %}">
            <div class="message-header">
                <div class="message-sender">
                    <h3>{{ message.name }}</h3>
                    <span class="message-email">{{ message.email }}</span>
                </div>
                <div class="message-meta">
                    <span class="message-date">{{ message.created_at[:16] }}</span>
                    {% if not message.is_read %}
                    <span class="message-status new">NEW</span>
                    {% else %}
                    <span class="message-status read">READ</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="message-content">
                <p>{{ message.message }}</p>
            </div>
            
            <div class="message-actions">
                <form action="{{ url_for('toggle_message_read', message_id=message.id) }}" method="POST" class="inline-form">
                    <button type="submit" class="btn btn-sm {% if message.is_read %}btn-warning{% else %}btn-success{% endif %}">
                        <i class="fas {% if message.is_read %}fa-envelope{% else %}fa-envelope-open{% endif %}"></i>
                        {% if message.is_read %}Mark as Unread{% else %}Mark as Read{% endif %}
                    </button>
                </form>
                
                <form action="{{ url_for('delete_message', message_id=message.id) }}" method="POST" class="inline-form">
                    <button type="submit" class="btn btn-sm btn-danger" 
                            onclick="return confirm('Are you sure you want to delete this message?')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-messages">
        <i class="fas fa-inbox"></i>
        <h3>No Messages Yet</h3>
        <p>You haven't received any contact messages yet.</p>
    </div>
    {% endif %}
</div>

<style>

</style>
{% endblock %}